!function(e){class t{constructor(e){this.xDown=null,this.yDown=null,this.options=e,this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),document.addEventListener("touchstart",this.handleTouchStart,!1),document.addEventListener("touchmove",this.handleTouchMove,!1)}onLeft(){this.options.onLeft()}onRight(){this.options.onRight()}onUp(){this.options.onUp()}onDown(){this.options.onDown()}static getTouches(e){return e.touches}handleTouchStart(e){e=t.getTouches(e)[0];this.xDown=e.clientX,this.yDown=e.clientY}handleTouchMove(e){var t;this.xDown&&this.yDown&&(t=e.touches[0].clientX,e=e.touches[0].clientY,t=this.xDown-t,e=this.yDown-e,Math.abs(t)>Math.abs(e)?0<t&&this.options.onLeft?this.onLeft():this.options.onRight&&this.onRight():0<e&&this.options.onUp?this.onUp():this.options.onDown&&this.onDown(),this.xDown=null,this.yDown=null)}}e.MBSwiper=new t}(window);class MB_File{constructor(e,t){this.Url=e,this.Name=this.Url.substr(this.Url.lastIndexOf("/")+1);e=this.Url.lastIndexOf(".");let i="";if(-1<e&&(i=this.Url.substr(e)),this.extension=i,this.directory=this.Url.substr(0,this.Url.lastIndexOf("/")),this.supportPdf()&&(this.filetypes.iframe=[".pdf"]),t)this.Type=t;else for(const s in this.filetypes)-1<this.filetypes[s].indexOf(this.extension)&&(this.Type=s)}Name="";Url="";ext="";filetypes={image:".jpg,.jpeg,.svg,.gif,.png".split(","),video:".mov,.mpeg,.mp4".split(","),audio:".mp3,.wav".split(",")};Type="other";supportPdf(){return navigator.mimeTypes["application/pdf"]||e("AcroPDF.PDF")||e("PDF.PdfCtrl")||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;function e(e){try{return new ActiveXObject(e)}catch(e){}}}}class FM_Viewer{constructor(e){try{this.element=document.querySelector(e),this.btnChoose=this.element.querySelector('[data-action="select-file"]'),this.btnDownload=this.element.querySelector('[data-action="download-file"]'),this.btnPrevious=this.element.querySelector('[data-action="previous"]'),this.btnNext=this.element.querySelector('[data-action="next"]'),this.btnClose=this.element.querySelector('[data-action="close-viewer"]'),this.btnFullScreen=this.element.querySelector('[data-action="toggle-fullscreen"]')}catch(e){console.log(e)}this.initButtons(),window.MBSwiper.options={onLeft:()=>this.next(),onRight:()=>this.previous(),onUp:()=>this.hide()}}element=null;files=[];_currentFile=-1;btnNext=null;btnPrevious=null;btnChoose=null;btnClose=null;btnDownload=null;btnFullScreen=null;_currentId=0;set currentId(e){this.currentFile=e,this._currentId=e}get currentFile(){return this._currentFile}set currentFile(t){if(!((this._currentFile=t)<0||t>=this.files.length)){let e=this.element.querySelector(".viewer-title");e&&0<=t&&(e.innerHTML=this.files[t].Name||"")}}get nextItem(){return this.currentFile++,this.currentFile>=this.files.length&&(this.currentFile=0),"Folder"==this.files[this.currentFile].Type?this.nextItem:this.currentFile}get previousItem(){return this.currentFile--,this.currentFile<0&&(this.currentFile=this.files.length-1),"Folder"==this.files[this.currentFile].Type?this.previousItem:this.currentFile}initLinks(){var t=document.querySelectorAll("[data-fmviewer]");const s=this;for(let e=0;e<t.length;e++){const i=t[e],n=i.getAttribute("data-fmviewer"),r=[];i.addEventListener("click",function(e){const t=document.querySelectorAll(`[data-fmviewer="${n}"]`);var i=0;t.forEach(e=>{var t=e.getAttribute("data-type");r.push(new MB_File(e.href,t)),this.href==e.href&&(i=r.length-1)}),e.preventDefault(),s.show(i,r)})}}initButtons(){const e=this;this.btnClose&&this.btnClose.addEventListener("click",function(){e.hide()}),this.btnNext&&this.btnNext.addEventListener("click",function(){e.next()}),this.btnPrevious&&this.btnPrevious.addEventListener("click",function(){e.previous()}),this.btnDownload&&this.btnDownload.addEventListener("click",function(){e.downloadCurrent()}),this.btnFullScreen&&this.btnFullScreen.addEventListener("click",function(){e.toggleFullScreen()}),this.initLinks()}show(e,t){this.element.classList.remove("off-screen"),this.files=t||[],this.render(e),1<this.files.length?(this.btnNext.classList.remove("disabled"),this.btnPrevious.classList.remove("disabled")):t&&(this.btnNext.classList.add("disabled"),this.btnPrevious.classList.add("disabled"))}hide(){const t=this;document.fullscreenElement&&document.exitFullscreen(),this.hideCurrentFile().then(e=>t.element.classList.add("off-screen")),this.currentFile=-1}render(t){const i=this;Number.isInteger(t)?this.hideCurrentFile().then(e=>{i.currentId=t,this.showCurrentFile().then(e=>{})}):(this.files.push(new MB_File(t)),this.currentFile=this.files.length-1,this.showCurrentFile().then(e=>{}))}hideCurrentFile(e){const i=this,s=e||"fade-out";return new Promise(e=>{if(-1==i.currentFile)e(!0);else{const t=i.element.querySelector(".viewer-content");t?(t.classList.add(s),setTimeout(()=>{t.remove(),e(!0)},500)):e(!1)}})}showCurrentFile(e){let s=this.files[this.currentFile];const n=e||"fade-in";return new Promise((t,i)=>{switch(s.Type){case"image":this.showCurrentImage(n).then(e=>{t(e)}).catch(e=>i(e));break;case"video":this.showVideo(n).then(e=>{t(e)}).catch(e=>i(e));break;case"audio":break;case"iframe":this.showIframe(n).then(e=>{t(e)}).catch(e=>i(e));break;default:this.showUnHandledFile(n).then(e=>{t(e)}).catch(e=>i(e))}})}showCurrentImage(e){const i=this,s=e||"fade-in";let n=this.files[this.currentFile];return new Promise(e=>{let t=document.createElement("img");t.classList.add("viewer-content"),t.classList.add(s),t.addEventListener("load",()=>{i.element.appendChild(t),setTimeout(()=>{t.classList.remove(s),e(!0)},300)}),t.src=n.Url})}showIframe(e){const i=e||"fade-in",s=this;let n=this.files[this.currentFile];return new Promise(e=>{let t=document.createElement("iframe");t.classList.add("viewer-content"),t.classList.add(i),t.src=n.Url,s.element.appendChild(t),setTimeout(()=>{t.classList.remove(i),e(!0)},300)})}showVideo(e){const i=e||"fade-in",s=this;let n=this.files[this.currentFile];return new Promise(e=>{let t=document.createElement("video");t.classList.add("viewer-content"),t.classList.add(i),t.src=n.Url,t.setAttribute("controls","true"),t.setAttribute("autoplay","true"),s.element.appendChild(t),setTimeout(()=>{t.classList.remove(i),e(!0)},300)})}showUnHandledFile(e){const i=e||"fade-in",s=this;let n=this.files[this.currentFile];return new Promise(e=>{let t=document.createElement("div");t.classList.add("viewer-content"),t.classList.add("text-white"),t.classList.add("text-center"),t.classList.add(i),t.innerHTML=`   <h3>Anteprima non disponibile</h3> 
                                <p>Viewer non è in grado di visualizzare il file</p>
                                <div><a href="${n.Url}" class="btn btn-warning">Scarica "${n.Name}"</button></div>`,s.element.appendChild(t),setTimeout(()=>{t.classList.remove(i),e(!0)},300)})}downloadCurrent(){var e=this.files[this.currentFile].Url,t=this.files[this.currentFile].Name;let i=document.createElement("a");i.download=t,i.href=e,i.click()}next(){const t=this;this.hideCurrentFile("fade-left").then(e=>{t.currentFile=t.nextItem,t.showCurrentFile("fade-right")})}previous(){const t=this;this.hideCurrentFile("fade-right").then(e=>{t.currentFile=t.previousItem,t.showCurrentFile("fade-left")})}toggleFullScreen(){const e=this.element;const t=this.btnFullScreen.querySelector(".fa");document.fullscreenElement?(document.exitFullscreen(),t.classList.add("fa-arrows-alt"),t.classList.remove("fa-compress")):e.requestFullscreen().then(()=>{t.classList.remove("fa-arrows-alt"),t.classList.add("fa-compress")}).catch(e=>{Swal.fire({icon:"error",text:`Impossibile impostare la modalità "fullscreen": ${e.message} (${e.name})`})})}}